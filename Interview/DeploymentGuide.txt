===================================================================================
                    üöÄ DEPLOYMENT GUIDE - Smart Stay
===================================================================================

                        Local Development & Production Deployment

===================================================================================
                         LOCAL DEVELOPMENT SETUP
===================================================================================

PREREQUISITES:
-------------
1. Node.js (v18+)
2. Python (3.10+)
3. MongoDB (local or Atlas)
4. Git

STEP 1: Clone & Setup
--------------------
    git clone <repo-url>
    cd "Smart Stay"

STEP 2: Install Node Dependencies
--------------------------------
    npm install

STEP 3: Setup Python Virtual Environment
---------------------------------------
    cd AI
    python3 -m venv venv
    source venv/bin/activate   # Mac/Linux
    # venv\Scripts\activate    # Windows
    pip install -r requirements.txt
    cd ..

STEP 4: Environment Variables
----------------------------
Create .env file in AI/ folder:

    # AI/.env
    OPENAI_API_KEY=sk-your-openai-key
    TAVILY_API_KEY=tvly-your-tavily-key
    MONGO_URL=mongodb://127.0.0.1:27017/smartstay

STEP 5: Start MongoDB
--------------------
    # If using local MongoDB
    mongod
    
    # Or use MongoDB Atlas (cloud)

STEP 6: Initialize Database (First time only)
--------------------------------------------
    cd init
    node index.js   # Seeds sample hotel data
    cd ..

STEP 7: Start Services
---------------------
Using start.sh (recommended):
    chmod +x start.sh
    ./start.sh

Or manually:
    # Terminal 1 - FastAPI
    cd AI && source venv/bin/activate && python main.py
    
    # Terminal 2 - Express
    node app.js

STEP 8: Access Application
-------------------------
    Main App: http://localhost:8080
    AI API: http://localhost:8000
    API Docs: http://localhost:8000/docs

===================================================================================
                         ENVIRONMENT VARIABLES REFERENCE
===================================================================================

EXPRESS (app.js):
----------------
    PORT=8080                    # Express server port
    MONGO_URL=mongodb://...      # MongoDB connection
    AI_SERVICE_URL=http://localhost:8000  # FastAPI URL

FASTAPI (AI/.env):
-----------------
    OPENAI_API_KEY=sk-...        # OpenAI API key (Required)
    TAVILY_API_KEY=tvly-...      # Tavily search (Required for web search)
    MONGO_URL=mongodb://...       # For checkpointing
    PORT=8000                     # FastAPI port

===================================================================================
                         PRODUCTION DEPLOYMENT OPTIONS
===================================================================================

OPTION 1: RENDER.COM (Recommended for beginners)
------------------------------------------------

Advantages:
- Free tier available
- Easy deployment
- Auto SSL

Steps:
1. Push code to GitHub

2. Deploy Express Service:
   - New Web Service ‚Üí Connect repo
   - Build Command: npm install
   - Start Command: node app.js
   - Add environment variables

3. Deploy FastAPI Service:
   - New Web Service ‚Üí Connect repo
   - Root Directory: AI
   - Build Command: pip install -r requirements.txt
   - Start Command: uvicorn main:app --host 0.0.0.0 --port $PORT
   - Add environment variables

4. Update Express to point to FastAPI URL

---

OPTION 2: RAILWAY
-----------------

Advantages:
- Simple deployment
- Good free tier
- Multiple services in one project

Steps:
1. Create Railway project
2. Add Express service from GitHub
3. Add Python service from GitHub (AI folder)
4. Add MongoDB service (or use Atlas)
5. Configure environment variables
6. Deploy

---

OPTION 3: AWS (Production Scale)
-------------------------------

Architecture:
    Route 53 (DNS)
         ‚Üì
    CloudFront (CDN)
         ‚Üì
    ALB (Load Balancer)
         ‚Üì
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ   EC2   ‚îÇ   EC2   ‚îÇ
    ‚îÇ Express ‚îÇ FastAPI ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚Üì
    MongoDB Atlas / DocumentDB

Steps:
1. Create EC2 instances or use ECS/EKS
2. Setup ALB for load balancing
3. Use MongoDB Atlas for database
4. Configure security groups
5. Setup CI/CD with CodePipeline

---

OPTION 4: DOCKER DEPLOYMENT
--------------------------

Dockerfile for Express:
    FROM node:18-alpine
    WORKDIR /app
    COPY package*.json ./
    RUN npm install
    COPY . .
    EXPOSE 8080
    CMD ["node", "app.js"]

Dockerfile for FastAPI:
    FROM python:3.10-slim
    WORKDIR /app
    COPY requirements.txt .
    RUN pip install -r requirements.txt
    COPY . .
    EXPOSE 8000
    CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000"]

docker-compose.yml:
    version: '3.8'
    services:
      express:
        build: .
        ports:
          - "8080:8080"
        environment:
          - MONGO_URL=mongodb://mongo:27017/smartstay
          - AI_SERVICE_URL=http://fastapi:8000
        depends_on:
          - mongo
          - fastapi
      
      fastapi:
        build: ./AI
        ports:
          - "8000:8000"
        environment:
          - OPENAI_API_KEY=${OPENAI_API_KEY}
          - TAVILY_API_KEY=${TAVILY_API_KEY}
        depends_on:
          - mongo
      
      mongo:
        image: mongo:6
        ports:
          - "27017:27017"
        volumes:
          - mongo_data:/data/db
    
    volumes:
      mongo_data:

Run:
    docker-compose up -d

===================================================================================
                         PRODUCTION CHECKLIST
===================================================================================

SECURITY:
‚ñ° Use environment variables (never commit .env)
‚ñ° Enable HTTPS (SSL certificates)
‚ñ° Restrict CORS to your domain
‚ñ° Add rate limiting
‚ñ° Validate all inputs
‚ñ° Use helmet.js for Express

PERFORMANCE:
‚ñ° Enable gzip compression
‚ñ° Use CDN for static assets
‚ñ° Add caching where appropriate
‚ñ° Use connection pooling for MongoDB
‚ñ° Consider Redis for sessions

MONITORING:
‚ñ° Setup logging (Winston, Pino)
‚ñ° Add health check endpoints
‚ñ° Use monitoring service (DataDog, New Relic)
‚ñ° Setup alerts for errors

DATABASE:
‚ñ° Use MongoDB Atlas for managed hosting
‚ñ° Enable backups
‚ñ° Setup proper indexes
‚ñ° Use replica sets for high availability

CI/CD:
‚ñ° Setup GitHub Actions for testing
‚ñ° Automate deployments
‚ñ° Run tests before deploy
‚ñ° Use staging environment

===================================================================================
                         TROUBLESHOOTING
===================================================================================

ISSUE: MongoDB connection refused
SOLUTION: 
    - Check if MongoDB is running: mongod
    - Verify MONGO_URL is correct
    - Check firewall settings

ISSUE: FastAPI not starting
SOLUTION:
    - Activate virtual environment: source venv/bin/activate
    - Install dependencies: pip install -r requirements.txt
    - Check for import errors: python -c "import main"

ISSUE: OpenAI API errors
SOLUTION:
    - Verify API key is set: echo $OPENAI_API_KEY
    - Check API key validity
    - Check rate limits

ISSUE: Express can't reach FastAPI
SOLUTION:
    - Verify FastAPI is running: curl http://localhost:8000/health
    - Check AI_SERVICE_URL environment variable
    - Check firewall/network settings

ISSUE: CORS errors
SOLUTION:
    - Add your domain to CORS origins in FastAPI
    - Check preflight requests

===================================================================================
                         COST CONSIDERATIONS
===================================================================================

FREE TIER OPTIONS:
-----------------
- Render: Free tier (limited hours)
- Railway: $5 credit/month
- Vercel: Free for frontend
- MongoDB Atlas: 512MB free cluster
- OpenAI: Pay-as-you-go (starts ~$5)

ESTIMATED MONTHLY COSTS (Low traffic):
------------------------------------
- Hosting (Render/Railway): $0-$7
- MongoDB Atlas: $0 (free tier)
- OpenAI API: $5-$20
- Tavily API: $0 (free tier has limits)
- Domain: $10-$15/year

TOTAL: ~$5-$30/month for low traffic

===================================================================================
                         QUICK START COMMANDS
===================================================================================

# Start everything locally
./start.sh

# Or manually:
# Terminal 1
cd AI && source venv/bin/activate && python main.py

# Terminal 2
node app.js

# Check services
curl http://localhost:8080/health
curl http://localhost:8000/health

# View logs
tail -f logs/app.log

===================================================================================

